//-----------------------------------------------------------------------------
// <copyright file="DwtEncrypter.cs" company="SW Okolo IT">
// Copyright (c) SW Okolo IT. All rights reserved.
// </copyright>
// <summary>
// Содержит класс для расшифровки данных заголовка.
// </summary>
//-----------------------------------------------------------------------------

namespace DwtReader.Components
{
    /// <summary>
    /// Расшифровщик данных при помощи магических чисел.
    /// </summary>
    internal class DwtEncrypter
    {
        /// <summary>
        /// Массив с магическими числами.
        /// </summary>
        private static byte[] _dwtMagicNum = {
            0x29, 0x23, 0xbe, 0x84, 0xe1, 0x6c, 0xd6, 0xae,
            0x52, 0x90, 0x49, 0xf1, 0xf1, 0xbb, 0xe9, 0xeb,
            0xb3, 0xa6, 0xdb, 0x3c, 0x87, 0x0c, 0x3e, 0x99,
            0x24, 0x5e, 0x0d, 0x1c, 0x06, 0xb7, 0x47, 0xde,
            0xb3, 0x12, 0x4d, 0xc8, 0x43, 0xbb, 0x8b, 0xa6,
            0x1f, 0x03, 0x5a, 0x7d, 0x09, 0x38, 0x25, 0x1f,
            0x5d, 0xd4, 0xcb, 0xfc, 0x96, 0xf5, 0x45, 0x3b,
            0x13, 0x0d, 0x89, 0x0a, 0x1c, 0xdb, 0xae, 0x32,
            0x20, 0x9a, 0x50, 0xee, 0x40, 0x78, 0x36, 0xfd,
            0x12, 0x49, 0x32, 0xf6, 0x9e, 0x7d, 0x49, 0xdc,
            0xad, 0x4f, 0x14, 0xf2, 0x44, 0x40, 0x66, 0xd0,
            0x6b, 0xc4, 0x30, 0xb7, 0x32, 0x3b, 0xa1, 0x22,
            0xf6, 0x22, 0x91, 0x9d, 0xe1, 0x8b, 0x1f, 0xda,
            0xb0, 0xca, 0x99, 0x02
        };

        /// <summary>
        /// Расшивровка данных.
        /// </summary>
        /// <param name="data">Массив с даннми</param>
        /// <returns>Расшифрованный масиив</returns>
        public byte[] Decrupt(byte[] data)
        {
            byte[] result = new byte[data.Length];
            for (var i = 0; i < data.Length; ++i)
                result[i] = (byte)(_dwtMagicNum[i] ^ data[i]);

            return result;
        }
    }
}
